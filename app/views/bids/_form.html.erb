



<%= nested_form_for @bid,html: {:id => 'bids'} do |form| %>
  <% if bid.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(bid.errors.count, "error") %> prohibited this bid from being saved:</h2>

      <ul>
      <% bid.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :project_id, :value => params[:project] %>
  <%= form.hidden_field :user_id, :value => current_user.id %>


  <%= form.link_to_add "Add a installment", :installments, :id =>"add_installment" %>


  <% form.fields_for :installments,html: {:id => 'installments'} do |fi|  %>

  <div class="my_insta">
    <%= fi.label :time,"Time" %><br>
    <%= fi.text_field :time, :id => "time_field",:required => true %>
  </div>
  <div class="my_insta">
    <%= fi.label :details,"Details" %><br>
    <%= fi.text_area :details , :id => "details_field",:required => true %>
  </div>
  <div class="my_insta">
    <%= fi.label :budget,"Budget" %><br>
    <%= fi.text_field :budget, :id => "budget_field",:required => true %>
  </div>

<input type="hidden" id="count"  name="start_count" value="" />


 <%#= link_to 'Destroy', @installment, method: :delete, data: { confirm: 'Are you sure?' } %>

  <%end%>

<br>
<br>
  <div class="actions new_bid">
    <%= form.submit %>
  </div>

<% end %>
<script type="text/javascript">
   $(document).ready(function(){

    $("#add_installment").click(function(){
      $('#add_company_div').before($("#add_company_div").clone().attr("id","add_company_div" + i));
       $("#add_company_div" + i + " :input").each(function(){
          $(this).attr("name",$(this).attr("name") + i);
          $(this).attr("id",$(this).attr("id") + i);
          $(this).attr("count",i); 
                 
          });
    });

    $('#bids').validate({
      
      });


    $.validator.addMethod('positiveNumber',
          function (value) {
              return Number(value) > 0;
          }, 'Enter a positive number');

    $.validator.addMethod('limitNumber',
          function (value) {
              return Number(value) < 999;
          }, 'Enter a valid value');
    $("#time_field").rules( "add", {
    required: true,
    number: true,
    positiveNumber: true,
    limitNumber: true,
    messages: {
    required: "Time is mandatory",
    number: "Time can only be integer"
    }
    });

    $( "#details_field" ).rules( "add", {
  required: true,
  minlength: 400,
  messages: {
    required: "Details are required",
    minlength: jQuery.validator.format("Please, at least {0} characters are necessary")
  }
  });
 $( "#budget_field" ).rules( "add", {
    required: true,
    number: true,
    positiveNumber: true,
    limitNumber: true,
  messages: {
    required: "Budget is mandatory",
    number: "Budget can only be integer"
  }
  });

if($('#count').val())
{
  var i= $('#count').val();
}
else 
{
  var i=0;
}

    

});
</script>
